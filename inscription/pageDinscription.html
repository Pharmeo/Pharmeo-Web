<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="pageDinscription.css">
    <title>Inscription</title>
</head>

<body>
    <div class="container d-flex flex-column align-items-center justify-content-center mt-1 p-4 border rounded"
        style="max-width: 600px;">
        <h2 class="text-center mb-4">Formulaire d'enregistrement</h2>

        <!-- Identifiant -->
        <div class="mb-3 w-100">
            <label for="identifiant" class="form-label">Votre email :</label>
            <input type="email" class="form-control" id="identifiant" placeholder="exemple@gmail.fr" required>
            <div id="emailError" class="text-danger" style="display:none;">Veuillez entrer une adresse email valide.</div>
        </div>

        <!-- Mot de passe -->
        <div class="mb-3 w-100">
            <label for="password" class="form-label">Votre mot de passe :</label>
            <input type="password" class="form-control" id="password" placeholder="ex: toto" required>
        </div>

        <!-- Retaper mot de passe -->
        <div class="mb-3 w-100">
            <label for="confirmPassword" class="form-label">Retaper votre mot de passe :</label>
            <input type="password" class="form-control" id="confirmPassword" placeholder="" required>
            <div id="passwordError" class="text-danger" style="display:none;">Les mots de passe ne correspondent pas.</div>
        </div>

        <!-- Rôle -->
        <div class="mb-3 w-100">
            <label for="role" class="form-label">Choisir votre rôle :</label>
            <select id="role" class="form-select" required>
                <option value="" selected disabled>-- Sélectionnez un rôle --</option>
                <option value="pharmacien">Pharmacien</option>
                <option value="admin">Administrateur</option>
            </select>
        </div>

        <hr class="w-100">

        <!-- Prénom, Nom, Mobile in one row -->
        <div class="row w-100">
            <div class="col-md-4 mb-3">
                <label for="prenom" class="form-label">Prénom :</label>
                <input type="text" class="form-control" id="prenom" placeholder="ex: Henri" required>
            </div>
            <div class="col-md-4 mb-3">
                <label for="nom" class="form-label">Nom :</label>
                <input type="text" class="form-control" id="nom" placeholder="ex: Delacour" required>
            </div>
            <div class="col-md-4 mb-3">
                <label for="mobile" class="form-label">Mobile :</label>
                <input type="tel" class="form-control" id="mobile" placeholder="ex: 072515****" required>
            </div>
        </div>

        <!-- Code postal -->
        <div class="mb-4 w-100">
            <label for="postalCode" class="form-label">Code Postal :</label>
            <input type="text" class="form-control" id="postalCode" placeholder="ex: 60200" required>
        </div>

        <!-- Adresse -->
        <div class="mb-3 w-100">
            <label for="adresse" class="form-label">Adresse :</label>
            <input type="text" class="form-control" id="adresse" placeholder="ex: rue des exemple" required>
        </div>

        <!-- Ville -->
        <div class="mb-3 w-100">
            <label for="ville" class="form-label">Ville :</label>
            <input type="text" class="form-control" id="ville" placeholder="ex: Monako" required>
        </div>

        <!-- Bouton Enregistrer -->
        <div class="d-flex justify-content-center w-100">
            <button id="registerButton" class="btn btn-primary px-4" disabled>Enregistrer</button>
        </div>
    </div>

    <script>
        const identifiant = document.getElementById('identifiant');
        const password = document.getElementById('password');
        const confirmPassword = document.getElementById('confirmPassword');
        const prenom = document.getElementById('prenom');
        const nom = document.getElementById('nom');
        const mobile = document.getElementById('mobile');
        const postalCode = document.getElementById('postalCode');
        const ville = document.getElementById('ville');
        const adresse = document.getElementById('adresse');
        const role = document.getElementById('role');
        const registerButton = document.getElementById('registerButton');
        const emailError = document.getElementById('emailError');
        const passwordError = document.getElementById('passwordError');

        // Validation de l'email
        function validateEmail(email) {
            const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            return emailRegex.test(email);
        }

        // Vérification des mots de passe
        function validatePasswords() {
            return password.value === confirmPassword.value;
        }

        // Fonction pour vérifier si tous les champs sont remplis et valides
        function checkInputs() {
            const inputs = [identifiant, password, confirmPassword, prenom, nom, mobile, postalCode, adresse, ville, role];
            let allFilled = true;

            inputs.forEach(input => {
                if (input.value.trim() === '') {
                    allFilled = false;
                }
            });

            if (!validateEmail(identifiant.value)) {
                emailError.style.display = 'block';
                allFilled = false;
            } else {
                emailError.style.display = 'none';
            }

            if (!validatePasswords()) {
                passwordError.style.display = 'block';
                allFilled = false;
            } else {
                passwordError.style.display = 'none';
            }

            registerButton.disabled = !allFilled;
        }

        // Écouteurs d'événements
        const inputs = [identifiant, password, confirmPassword, prenom, nom, mobile, postalCode, adresse, ville, role];
        inputs.forEach(input => {
            input.addEventListener('input', checkInputs);
        });

        // Envoi de la requête POST
        async function sendPostRequest() {
            if (!validatePasswords()) {
                alert('Les mots de passe ne correspondent pas');
                return;
            }

            const data = {
                fk_profil: role.value === 'admin' ? '1' : '3',
                nom_compte: identifiant.value,
                mot_de_passe: password.value,
                nom: nom.value,
                prenom: prenom.value,
                numero_telephone: mobile.value,
                mail: identifiant.value,
                adresse: adresse.value,
                ville: ville.value,
                code_postal: postalCode.value
            };

            try {
                const response = await fetch('http://localhost:3000/createClient', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    window.location.href = "../Accuil/home.html";
                } else {
                    alert('Erreur lors de la création de l\'utilisateur');
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Une erreur est survenue lors de l\'envoi des données');
            }
        }

        registerButton.addEventListener('click', function (event) {
            event.preventDefault();
            sendPostRequest();
        });
    </script>
</body>

</html>
